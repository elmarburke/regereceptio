!function(a,b,c){"use strict";b.module("ngResource",["ng"]).factory("$resource",["$http","$parse",function(a,d){function e(a){return f(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function f(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function g(a,b){this.template=a+="#",this.defaults=b||{};var c=this.urlParams={};k(a.split(/\W/),function(b){b&&new RegExp("(^|[^\\\\]):"+b+"\\W").test(a)&&(c[b]=!0)}),this.template=a.replace(/\\:/g,":")}function h(d,e,f){function p(a,b){var c={};return b=l({},e,b),k(b,function(b,d){c[d]=b.charAt&&"@"==b.charAt(0)?o(a,b.substr(1)):b}),c}function q(a){m(a||{},this)}var r=new g(d);return f=l({},i,f),k(f,function(d,e){d.method=b.uppercase(d.method);var f="POST"==d.method||"PUT"==d.method||"PATCH"==d.method;q[e]=function(b,c,e,g){var h,i={},o=j,s=null;switch(arguments.length){case 4:s=g,o=e;case 3:case 2:if(!n(c)){i=b,h=c,o=e;break}if(n(b)){o=b,s=c;break}o=c,s=e;case 1:n(b)?o=b:f?h=b:i=b;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}var t=this instanceof q?this:d.isArray?[]:new q(h);return a({method:d.method,url:r.url(l({},p(h,d.params||{}),i)),data:h}).then(function(a){var b=a.data;b&&(d.isArray?(t.length=0,k(b,function(a){t.push(new q(a))})):m(b,t)),(o||j)(t,a.headers)},s),t},q.prototype["$"+e]=function(a,b,d){var g,h=p(this),i=j;switch(arguments.length){case 3:h=a,i=b,g=d;break;case 2:case 1:n(a)?(i=a,g=b):(h=a,i=b||j);case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var k=f?this:c;q[e].call(this,h,k,i,g)}}),q.bind=function(a){return h(d,l({},e,a),f)},q}var i={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},j=b.noop,k=b.forEach,l=b.extend,m=b.copy,n=b.isFunction,o=function(a,b){return d(b)(a)};return g.prototype={url:function(a){var c,d,g=this,h=this.template;a=a||{},k(this.urlParams,function(f,i){c=a.hasOwnProperty(i)?a[i]:g.defaults[i],b.isDefined(c)&&null!==c?(d=e(c),h=h.replace(new RegExp(":"+i+"(\\W)","g"),d+"$1")):h=h.replace(new RegExp("(/?):"+i+"(\\W)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c})}),h=h.replace(/\/?#$/,"");var i=[];return k(a,function(a,b){g.urlParams[b]||i.push(f(b)+"="+f(a))}),i.sort(),h=h.replace(/\/*$/,""),h+(i.length?"?"+i.join("&"):"")}},h}])}(window,window.angular),function(a,b,c){"use strict";b.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(a,d){function e(){var a,e,f,i;for(a in h)k(g[a])&&d.cookies(a,c);for(a in g)e=g[a],b.isString(e)?e!==h[a]&&(d.cookies(a,e),i=!0):b.isDefined(h[a])?g[a]=h[a]:delete g[a];if(i){i=!1,f=d.cookies();for(a in g)g[a]!==f[a]&&(k(f[a])?delete g[a]:g[a]=f[a],i=!0)}}var f,g={},h={},i=!1,j=b.copy,k=b.isUndefined;return d.addPollFn(function(){var b=d.cookies();f!=b&&(f=b,j(b,h),j(b,g),i&&a.$apply())})(),i=!0,a.$watch(e),g}]).factory("$cookieStore",["$cookies",function(a){return{get:function(c){var d=a[c];return d?b.fromJson(d):d},put:function(c,d){a[c]=b.toJson(d)},remove:function(b){delete a[b]}}}])}(window,window.angular),function(a,b){"use strict";function c(a){var b,c={},d=a.split(",");for(b=0;b<d.length;b++)c[d[b]]=!0;return c}function d(a,c){function d(a,d,g,h){if(d=b.lowercase(d),v[d])for(;q.last()&&w[q.last()];)f("",q.last());u[d]&&q.last()==d&&f("",d),h=r[d]||!!h,h||q.push(d);var i={};g.replace(k,function(a,b,c,d,f){var g=c||d||f||"";i[b]=e(g)}),c.start&&c.start(d,i,h)}function f(a,d){var e,f=0;if(d=b.lowercase(d))for(f=q.length-1;f>=0&&q[f]!=d;f--);if(f>=0){for(e=q.length-1;e>=f;e--)c.end&&c.end(q[e]);q.length=f}}var g,h,p,q=[],s=a;for(q.last=function(){return q[q.length-1]};a;){if(h=!0,q.last()&&x[q.last()])a=a.replace(new RegExp("(.*)<\\s*\\/\\s*"+q.last()+"[^>]*>","i"),function(a,b){return b=b.replace(n,"$1").replace(o,"$1"),c.chars&&c.chars(e(b)),""}),f("",q.last());else if(0===a.indexOf("<!--")?(g=a.indexOf("-->"),g>=0&&(c.comment&&c.comment(a.substring(4,g)),a=a.substring(g+3),h=!1)):m.test(a)?(p=a.match(j),p&&(a=a.substring(p[0].length),p[0].replace(j,f),h=!1)):l.test(a)&&(p=a.match(i),p&&(a=a.substring(p[0].length),p[0].replace(i,d),h=!1)),h){g=a.indexOf("<");var t=0>g?a:a.substring(0,g);a=0>g?"":a.substring(g),c.chars&&c.chars(e(t))}if(a==s)throw"Parse Error: "+a;s=a}f()}function e(a){return B.innerHTML=a.replace(/</g,"&lt;"),B.innerText||B.textContent||""}function f(a){return a.replace(/&/g,"&amp;").replace(q,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function g(a){var c=!1,d=b.bind(a,a.push);return{start:function(a,e,g){a=b.lowercase(a),!c&&x[a]&&(c=a),c||1!=y[a]||(d("<"),d(a),b.forEach(e,function(a,c){var e=b.lowercase(c);1!=A[e]||z[e]===!0&&!a.match(p)||(d(" "),d(c),d('="'),d(f(a)),d('"'))}),d(g?"/>":">"))},end:function(a){a=b.lowercase(a),c||1!=y[a]||(d("</"),d(a),d(">")),a==c&&(c=!1)},chars:function(a){c||d(f(a))}}}var h=function(a){var b=[];return d(a,g(b)),b.join("")},i=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,j=/^<\s*\/\s*([\w:-]+)[^>]*>/,k=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,l=/^</,m=/^<\s*\//,n=/<!--(.*?)-->/g,o=/<!\[CDATA\[(.*?)]]>/g,p=/^((ftp|https?):\/\/|mailto:|#)/,q=/([^\#-~| |!])/g,r=c("area,br,col,hr,img,wbr"),s=c("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),t=c("rp,rt"),u=b.extend({},t,s),v=b.extend({},s,c("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),w=b.extend({},t,c("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),x=c("script,style"),y=b.extend({},r,v,w,u),z=c("background,cite,href,longdesc,src,usemap"),A=b.extend({},z,c("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,span,start,summary,target,title,type,valign,value,vspace,width")),B=document.createElement("pre");b.module("ngSanitize",[]).value("$sanitize",h),b.module("ngSanitize").directive("ngBindHtml",["$sanitize",function(a){return function(b,c,d){c.addClass("ng-binding").data("$binding",d.ngBindHtml),b.$watch(d.ngBindHtml,function(b){b=a(b),c.html(b||"")})}}]),b.module("ngSanitize").filter("linky",function(){var a=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s\.\;\,\(\)\{\}\<\>]/,b=/^mailto:/;return function(c){if(!c)return c;for(var d,e,f,h=c,i=[],j=g(i);d=h.match(a);)e=d[0],d[2]==d[3]&&(e="mailto:"+e),f=d.index,j.chars(h.substr(0,f)),j.start("a",{href:e}),j.chars(d[0].replace(b,"")),j.end("a"),h=h.substring(f+d[0].length);return j.chars(h),i.join("")}})}(window,window.angular),angular.module("localStorage",["ngCookies"]).factory("$store",["$parse","$cookieStore","$window","$log",function(a,b,c,d){var e="undefined"==typeof c.localStorage?void 0:c.localStorage,f=!("undefined"==typeof e||"undefined"==typeof c.JSON),g={parseValue:function(a){var b;try{b=c.JSON.parse(a),"undefined"==typeof b&&(b=a),"true"===b&&(b=!0),"false"===b&&(b=!1),c.parseFloat(b)!==b||angular.isObject(b)||(b=c.parseFloat(b))}catch(d){b=a}return b}},h={set:function(a,h){if(!f)try{return b.put(a,h),h}catch(i){d.log("Local Storage not supported, make sure you have angular-cookies enabled.")}var j=c.JSON.stringify(h);return e.setItem(a,j),g.parseValue(j)},get:function(a){if(!f)try{return g.parseValue($.cookie(a))}catch(b){return null}var c=e.getItem(a);return g.parseValue(c)},remove:function(a){if(!f)try{return b.remove(a),!0}catch(c){return!1}return e.removeItem(a),!0},bind:function(b,c,d){return d=angular.isUndefined(d)?"":d,h.get(c)||h.set(c,d),a(c).assign(b,h.get(c)),b.$watch(c,function(a){angular.isDefined(a)&&h.set(c,a)},!0),h.get(c)},unbind:function(b,c){a(c).assign(b,null),b.$watch(c,function(){}),h.remove(c)}};return h}]),angular.module("pouchdb-ng",[]).factory("pouchClient",["$rootScope","$q","safeApply","logger","pouchDatabase",function(a,b,c,d,e){function f(b,e){return function(f,g){c(a,function(){f?(d.log('pouch "'+e+'" returned error',f),b.reject(f)):(d.log('pouch "'+e+'" returned successfully',g),b.resolve(g))})}}var g={};return d.log("Creating pouch"),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),g.allDbs=function(){var a=b.defer();return Pouch.allDbs(f(a,"allDbs")),a.promise},Object.defineProperties(g,{enableAllDbs:{get:function(){return Pouch.enableAllDbs},set:function(a){Pouch.enableAllDbs=a}}}),g.create=function(a,b){return null==b&&(b={}),e(a,b)},g.destroy=function(a){var c=b.defer();return Pouch.destroy(a,f(c,"destroy")),c.promise},g.replicate=function(a,c,d){var e=b.defer();return null==d&&(d={}),Pouch.replicate(a,c,d,f(e,"replicate")),e.promise},g}]).factory("pouchDatabase",["$rootScope","$q","safeApply","logger",function(a,b,c,d){return function(e,f){function g(b,e){return function(f,g){c(a,function(){f?(d.log('pouchClient "'+e+'" returned error',f),b.reject(f)):(d.log('pouchClient "'+e+'" returned successfully',g),b.resolve(g))})}}d.log("Creating pouchClient"),null==f&&(f={});var h={};return h._database=new Pouch(e,f),h.post=function(a,c){var d=b.defer();return null==c&&(c={}),h._database.post(a,c,g(d,"post")),d.promise},h.put=function(a,c){var d=b.defer();return null==c&&(c={}),h._database.put(a,c,g(d,"put")),d.promise},h.putAttachment=function(a,c,d,e){var i=b.defer();return null==f&&(f={}),h._database.putAttachment(a,c,d,e,g(i,"putAttachment")),i.promise},h.getAttachment=function(a){var c=b.defer();return null==f&&(f={}),h._database.getAttachment(a,g(c,"getAttachment")),c.promise},h.removeAttachment=function(a,c){var d=b.defer();return null==f&&(f={}),h._database.removeAttachment(a,c,g(d,"removeAttachment")),d.promise},h.bulkDocs=function(a,c){var d=b.defer();return null==c&&(c={}),h._database.bulkDocs(a,c,g(d,"bulkDocs")),d.promise},h.get=function(a,c){var d=b.defer();return null==c&&(c={}),h._database.get(a,c,g(d,"get")),d.promise},h.allDocs=function(a){var c=b.defer();return null==a&&(a={}),h._database.allDocs(a,g(c,"allDocs")),c.promise},h.query=function(a,c){var d=b.defer();return null==c&&(c={}),h._database.query(a,c,g(d,"query")),d.promise},h.remove=function(a,c){var d=b.defer();return null==c&&(c={}),h._database.remove(a,c,g(d,"remove")),d.promise},h.info=function(){var a=b.defer();return h._database.info(g(a,"info")),a.promise},h.changes=function(a){return null==a&&(a={}),h._database.changes(a)},h.compact=function(a){var c=b.defer();return null==a&&(a={}),h._database.compact(a,g(c,"compact")),c.promise},h.revsDiff=function(a){var c=b.defer();return null==a&&(a={}),h._database.revsDiff(a,g(c,"revsDiff")),c.promise},h.replicate={to:function(a,c){var d=b.defer();return null==c&&(c={}),c.complete=g(d,"replicate_from"),h._database.replicate.to(a,c),d.promise},from:function(a,c){var d=b.defer();return null==c&&(c={}),c.complete=g(d,"replicate_from"),h._database.replicate.from(a,c),d.promise}},h}}]).factory("safeApply",["$rootScope",function(){return function(a,b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&a.$eval(b):b?a.$apply(b):a.$apply()}}]).provider("logger",function(){this.DEVMODE=!1,this.setDEVMODE=function(a){this.DEVMODE=a},this.$get=["$window",function(){var a=this.DEVMODE,b={};return b.log=function(){a&&console.log.apply(console,arguments)},b.always=function(){console.log.apply(console,arguments)},b}]}).config(["loggerProvider",function(a){a.setDEVMODE(!0)}]),angular.module("regereceptioApp").controller("TopicCtrl",["$scope","topic",function(a,b){b.fetch().then(function(b){a.topics=b}),a.addTopic=function(c){var d={_id:Math.uuid(),type:"topic",title:c,position:10*(a.topics.length+1)};b.put(d),a.newTopic=""},b.changed(function(b){a.$apply(function(){var c=a.topics.indexOfObject("_id",b.doc._id);0!==c.length||b.deleted?b.deleted?a.topics.splice(c[0],1):a.topics[c]=b.doc:a.topics.push(b.doc)})}),a.delete=function(a,c,d){b.remove({_id:c,_rev:d})}}]),angular.module("regereceptioApp").service("topic",["$rootScope","pouch","replicator",function(a,b){function c(a){a.type&&"topic"===a.type&&emit(a._id,a.title)}var d={},e=b;return d.fetch=function(){return e.query({map:c},{include_docs:!0}).then(function(a){var b=a.rows.map(function(a){return a.doc});return b})},d.put=b.put,d.changed=function(a){var c=function(a){return a.type&&"topic"===a.type||1==a._deleted?!0:!1};return b.info().then(function(d){return b.changes({since:d.update_seq,include_docs:!0,continuous:!0,filter:c,onChange:a})})},d.remove=b.remove,d}]),angular.module("regereceptioApp").service("pouch",["pouchClient",function(a){return new PouchDB("regerecepito"),a.create("regerecepito")}]),angular.module("regereceptioApp").controller("NavigationCtrl",["$scope","$location","replicator",function(a,b){a.title="Regereceptio",a.entries=[{title:"Start",href:"/"},{title:"Themen",href:"/topic"},{title:"Sendungen",href:"/episode"},{title:"Synchronisieren",href:"/replicate"}],a.location=b}]),angular.module("regereceptioApp").controller("TopiceditCtrl",["$scope","$routeParams","pouch","$location",function(a,b,c,d){var e=b.id;c.get(e).then(function(b){a.topic=b}),a.save=function(){c.put(a.topic).then(function(a){if(console.log(a),!a.ok)throw new Error("Data don't saved. "+JSON.stringify(a));d.path("/topic")})}}]),angular.module("regereceptioApp").controller("ReplicateIndexCtrl",["$scope","replicator","pouchClient","$window",function(a,b,c,d){a.replicateTo=function(c,d){b.addSync(c,d),a.remoteDB="",a.newReplicate.continuous=!1},a.resetDatabase=function(){d.confirm("Alle Daten werden gelöscht und die Seite neu geladen.")&&c.destroy("regerecepito").then(function(){delete d.localStorage.replicators}).then(function(){d.location.href="/replicate"})},a.removeReplicator=function(a){b.removeSync(a),d.confirm("Die Replizierung endet erst mit erneutem laden der Seite. \nJetzt neu laden?")&&(d.location.href="/replicate")}}]),angular.module("regereceptioApp").factory("replicator",["$store","pouch","$rootScope",function a(b,c,d){var a={};a.addSync=function(b,c){c.continuous&&d.replicators.push({remoteDb:b,options:c}),a.startSync(b,c)},a.removeSync=function(a){d.replicators.splice(a,1)};var e=function(){b.bind(d,"replicators"),"object"!=typeof d.replicators&&(d.replicators=[]),d.replicators.forEach(function(b){a.startSync(b.remoteDb,b.options)})};return a.startSync=function(a,b){c.replicate.to(a,b),c.replicate.from(a,b)},e(),a}]),angular.module("regereceptioApp").factory("episode",["pouch",function(a){function b(a){a.type&&a.episode&&"topic"===a.type&&emit(a.episode,a._id)}var c={};return c.allEpisodes=function(){var c={include_docs:!1,reduce:!0};return a.query({map:b,reduce:"_count"},c).then(function(a){return console.log(a),a.rows})},c.allTopicsOfAnEpisode=function(c){var d={include_docs:!0,reduce:!1,key:c};return a.query({map:b},d).then(function(a){var b=a.rows.map(function(a){return a.doc});return b})},c}]),angular.module("regereceptioApp").controller("EpisodeIndexCtrl",["$scope","episode",function(a,b){b.allEpisodes().then(function(b){a.episodes=b})}]),angular.module("regereceptioApp").controller("EpisodeDetailCtrl",["$scope","$routeParams","episode",function(a,b,c){var d=a.episodeName=b.episode_name;c.allTopicsOfAnEpisode(d).then(function(b){a.topics=b})}]);